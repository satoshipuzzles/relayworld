<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Relay World</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    
    <!-- Environment Configuration -->
    <script>
        // Provide fallback environment variables 
        window.GAME_MASTER_PUBKEY = '';
        window.GAME_MASTER_NSEC = '';
    </script>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="screen">
        <div class="login-panel">
            <h1>Relay World</h1>
            <p>Join the Nostr relay battlefield!</p>
            <button id="login-button" class="btn btn-primary">Login</button>
            <div id="login-status"></div>
            <div class="loader" id="login-loader"></div>
        </div>
    </div>

    <!-- Game Container -->
    <div id="game-container" class="screen">
        <canvas id="game-canvas"></canvas>
        <div id="ui-container">
            <!-- Player HUD -->
            <div id="player-hud" class="hud">
                <div id="player-profile">
                    <img id="player-avatar" src="https://via.placeholder.com/40" alt="Avatar" class="avatar">
                    <div>
                        <div id="player-name" class="name">Player</div>
                        <div id="player-level" class="level">Level: 1</div>
                    </div>
                </div>
                <div id="player-stats" class="stats">
                    <div class="stat-row"><span class="stat-label">Score:</span><span id="player-score">0</span></div>
                    <div class="stat-row"><span class="stat-label">Items:</span><span id="player-items">0</span></div>
                    <div class="stat-row"><span class="stat-label">Rep:</span><span id="player-reputation">0</span></div>
                </div>
                <div id="player-actions" class="actions">
                    <button id="post-note" class="btn btn-action">Post</button>
                    <button id="view-stats" class="btn btn-action">Stats</button>
                    <button id="create-guild" class="btn btn-action">Guild</button>
                    <button id="edit-profile" class="btn btn-action">Profile</button>
                </div>
            </div>

            <!-- Relay Selector -->
            <div id="relay-selector" class="panel">
                <h3>Relay</h3>
                <div id="relay-list" class="list"></div>
                <select id="time-range" class="select">
                    <option value="3600">1 Hr</option>
                    <option value="86400">1 Day</option>
                    <option value="604800">1 Wk</option>
                    <option value="2592000">1 Mo</option>
                </select>
            </div>

            <!-- Nostr Analytics -->
            <div id="nostr-analytics" class="panel">
                <h3>Analytics</h3>
                <div id="analytics-stats" class="stats">
                    <div>Authors: <span id="active-authors">0</span></div>
                    <div>Notes: <span id="note-count">0</span></div>
                    <div>Avg Len: <span id="avg-length">0</span></div>
                    <div>Top: <span id="most-active">-</span></div>
                </div>
            </div>

            <!-- Chat -->
            <div id="chat-container" class="panel chat">
                <div id="chat-messages" class="messages"></div>
                <div id="chat-input-container" class="input-container">
                    <input type="text" id="chat-input" placeholder="Chat..." class="input">
                    <button id="chat-send" class="btn btn-small">Send</button>
                </div>
            </div>

            <!-- Leaderboards -->
            <div id="leaderboard" class="panel leaderboard">
                <h3>Leaderboard</h3>
                <div id="current-leaderboard">
                    <h4>Top 10</h4>
                    <div id="leaderboard-entries" class="list"></div>
                </div>
                <div id="historical-leaderboard">
                    <h4>Hall of Fame</h4>
                    <div id="historical-entries" class="list"></div>
                </div>
            </div>
            <div id="guild-leaderboard" class="panel leaderboard">
                <h3>Guilds</h3>
                <div id="guild-entries" class="list"></div>
            </div>

            <!-- Inventory -->
            <button id="inventory-button" class="btn btn-float">Inv</button>
            <div id="inventory" class="modal">
                <div id="inventory-header" class="modal-header">
                    <h3 id="inventory-title">Inventory</h3>
                    <button id="inventory-close" class="btn btn-close">×</button>
                </div>
                <div id="inventory-content" class="modal-content"></div>
                <div id="crafting-section" class="modal-section">
                    <h4>Crafting</h4>
                    <div id="crafting-recipes" class="list"></div>
                </div>
            </div>

            <!-- Marketplace -->
            <div id="marketplace" class="panel">
                <h3>Market</h3>
                <div id="marketplace-listings" class="list"></div>
                <button id="list-item" class="btn btn-action">List</button>
            </div>

            <!-- Popups -->
            <div id="player-popup" class="popup">
                <div id="popup-header" class="popup-header">
                    <img id="popup-avatar" src="https://via.placeholder.com/40" alt="Avatar" class="avatar">
                    <div id="popup-name" class="name"></div>
                </div>
                <div id="popup-actions" class="actions">
                    <button id="popup-chat" class="btn btn-action">Chat</button>
                    <button id="popup-trade" class="btn btn-action">Trade</button>
                    <button id="popup-follow" class="btn btn-action">Follow</button>
                    <button id="popup-zap" class="btn btn-action">Zap</button>
                    <button id="popup-promote" class="btn btn-action">Promote</button>
                    <button id="popup-alliance" class="btn btn-action">Ally</button>
                </div>
                <div id="popup-chat-container" class="chat hidden">
                    <div id="popup-chat-messages" class="messages"></div>
                    <div id="popup-chat-input-container" class="input-container">
                        <input type="text" id="popup-chat-input" placeholder="Message..." class="input">
                        <button id="popup-chat-send" class="btn btn-small">Send</button>
                    </div>
                </div>
            </div>
            <div id="trade-interface" class="modal">
                <div id="trade-header" class="modal-header">
                    <h3 id="trade-title">Trade</h3>
                    <button id="trade-close" class="btn btn-close">×</button>
                </div>
                <div class="trade-section">
                    <h4>Your Items</h4>
                    <div id="your-trade-items" class="trade-items"></div>
                </div>
                <div class="trade-section">
                    <h4>Their Items</h4>
                    <div id="their-trade-items" class="trade-items"></div>
                </div>
                <div class="trade-footer">
                    <button id="trade-cancel" class="btn btn-cancel">Cancel</button>
                    <button id="trade-offer" class="btn btn-primary">Offer</button>
                </div>
            </div>
            <div id="zap-interface" class="modal">
                <div id="zap-header" class="modal-header">
                    <h3 id="zap-title">Zap</h3>
                    <button id="zap-close" class="btn btn-close">×</button>
                </div>
                <div id="zap-content" class="modal-content">
                    <input type="number" id="zap-amount" placeholder="Sats" class="input">
                    <textarea id="zap-message" placeholder="Message" class="input"></textarea>
                </div>
                <button id="zap-button" class="btn btn-primary">Zap</button>
            </div>

            <!-- Stats Modal -->
            <div id="stats-modal" class="modal">
                <h3>Stats</h3>
                <div id="stats-content" class="modal-content"></div>
                <button id="stats-close" class="btn btn-close">×</button>
            </div>

            <!-- Quest Notification -->
            <div id="quest-notification" class="notification">
                <div id="quest-title" class="title"></div>
                <div id="quest-description" class="description"></div>
                <div id="quest-progress" class="progress-bar">
                    <div id="quest-progress-bar" class="progress"></div>
                </div>
                <div id="quest-actions" class="actions">
                    <button id="quest-accept" class="btn btn-primary">Accept</button>
                    <button id="quest-decline" class="btn btn-cancel">Decline</button>
                </div>
            </div>

            <!-- Toast Notifications -->
            <div id="toast-container" class="toast-container"></div>

            <!-- Social Spaces -->
            <div id="corny-chat" class="audio-space">
                <div class="audio-space-header">
                    <div class="audio-space-title">Corny Chat</div>
                    <button id="corny-chat-close" class="btn btn-close">×</button>
                </div>
                <iframe class="audio-space-iframe" src="https://cornychat.com/relayworld"></iframe>
            </div>
            <div id="hive-talk" class="audio-space">
                <div class="audio-space-header">
                    <div class="audio-space-title">Hive Talk</div>
                    <button id="hive-talk-close" class="btn btn-close">×</button>
                </div>
                <iframe class="audio-space-iframe" src="https://hivetalk.org/join/RelayWorld"></iframe>
            </div>

            <!-- Mini-map -->
            <canvas id="mini-map" width="100" height="100" class="mini-map"></canvas>
        </div>
    </div>

    <!-- Bitcoin Connect Modal -->
    <div id="bitcoin-connect-modal" class="screen">
        <div class="bc-modal-content">
            <div class="bc-modal-header">
                <h3 class="bc-modal-title">Connect Wallet</h3>
                <button id="bc-modal-close" class="btn btn-close">×</button>
            </div>
            <div class="bc-connector-list">
                <div class="bc-connector" data-connector="Alby">
                    <img class="bc-connector-icon" src="https://via.placeholder.com/30" alt="Alby">
                    <div class="bc-connector-name">Alby</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/nostr-tools@1.7.5/lib/nostr.bundle.js"></script>
    
    <!-- Load config first -->
    <script src="js/config.js"></script>
    
    <!-- Other scripts in dependency order -->
    <script src="js/nostr.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/player.js"></script>
    <script src="js/world.js"></script>
    <script src="js/social.js"></script>
    <script src="js/economy.js"></script>
    <script src="js/quests.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game.js"></script>
    <script src="js/sdk.js"></script>
</body>
</html>
